<?php

use Drupal\Core\Entity\EntityInterface;

/**
 * @file
 * Contains az_groups.module.
 */

function az_groups_preprocess_page(&$variables) {
  return;
}

function az_groups_preprocess_menu_tree(&$variables) {
  return;
}

function az_groups_preprocess_block(&$variables) {
  return;
}

function az_groups_preprocess_group(&$variables) {

  $block_entity = Drupal\block\Entity\Block::load('groupoperations');
  $variables['block_groupoperations'] = \Drupal::entityTypeManager()->getViewBuilder('block')->view($block_entity);

  $block_entity = Drupal\block\Entity\Block::load('azdonateblock');
  $variables['block_donate'] = \Drupal::entityTypeManager()->getViewBuilder('block')->view($block_entity);

  $block_entity = Drupal\block\Entity\Block::load('azbooknavigation');
  $variables['block_booknavigation'] = \Drupal::entityTypeManager()->getViewBuilder('block')->view($block_entity);

  $variables['view_group_members'] = views_embed_view('group_members', 'group_members');

  $variables['view_group_content'] = views_embed_view('group_content', 'content_teaser_block');
  return;
}

function az_groups_preprocess_menu(&$variables) {
  if ($variables['menu_name'] == 'account' && $variables['logged_in']) {
    $user = \Drupal::entityTypeManager()
      ->getStorage('user')
      ->load(\Drupal::currentUser()->id());
    $picture = $user->field_picture->getValue();
    if (empty($picture[0])) {
      $variables['user_name'] = $user->name;
    }
    else {
      $file = \Drupal\file\Entity\File::load($picture[0]['target_id']);
      $variables['user_picture_url'] = \Drupal\image\Entity\ImageStyle::load('thumbnail_50_x_50')->buildUrl($file->getFileUri());
    }
  }

  return;
}
